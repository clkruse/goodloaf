import"./modulepreload-polyfill-9p4a8sJU.js";var _=Object.defineProperty,y=Object.defineProperties,b=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertySymbols,P=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable,g=(e,t,r)=>t in e?_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,x=(e,t)=>{for(var r in t||(t={}))P.call(t,r)&&g(e,r,t[r]);if(u)for(var r of u(t))S.call(t,r)&&g(e,r,t[r]);return e},I=(e,t)=>y(e,b(t)),v=(e,t,r)=>new Promise((i,s)=>{var w=a=>{try{h(r.next(a))}catch(c){s(c)}},f=a=>{try{h(r.throw(a))}catch(c){s(c)}},h=a=>a.done?i(a.value):Promise.resolve(a.value).then(w,f);h((r=r.apply(e,t)).next())}),p=class extends Error{constructor(e){e||(e="Whoops! Something went wrong."),super(`${e}`),Object.setPrototypeOf(this,Object.getPrototypeOf(this)),Error.captureStackTrace&&Error.captureStackTrace(this,p)}get name(){return this.constructor.name}},n=class extends p{get name(){return"CanvasScrollClipError"}},E=class extends p{log(e){console.log(`${this.name}: ${e}`)}warn(e){console.warn(`${this.name}: ${e}`)}},O=class extends E{constructor(e){super(e),this.warn(e)}},A=/\d+(?!.*\d+)/,o={viewport:{resize:"viewport.resize",scroll:"viewport.scroll"},images:{progress:"images.progress",loaded:"images.loaded"}},j=Object.values(o).map(e=>Object.values(e)).flat(),l=(e,t=0)=>{let r;return(...s)=>{r&&clearTimeout(r),r=setTimeout(()=>e(...s),t)}};function $(e){return v(this,null,function*(){return new Promise((t,r)=>{const i=new Image;i.onload=()=>{t(i)},i.src=e,i.onerror=()=>{r(new n(`Image with name '...${e.slice(-20)}' was not found.`))}})})}function L(e){return new Array(e.count).fill(0).map((t,r)=>$(B(e,r+1)))}function d(){return window.pageYOffset||document.documentElement.scrollTop}function m(e,t=d()){return(t-e.top)/(e.bottom-e.screen.height-e.top)}function B(e,t=1){return[e.path,e.image.start,t.toString().padStart(e.image.padStart,"0"),e.image.ending].join("")}function F(e){const t=e.split("/");return t.pop(),`${t.join("/")}/`}function C(e,t){const r=z(e),i=q(r),s=T(r);if(t.toString().length>s.length)throw new n("Leading zeros in first frame path has to be more than the frame count and sequence at the end.");return{start:r.slice(0,r.indexOf(s)),sequence:parseInt(s),padStart:s.length,ending:r.slice(r.indexOf(s)+s.length),extension:i}}function T(e){const t=e.match(A),r=t&&t[0]!==null?t[0]:"";if(r.length<2)throw new n('Bad image sequence format. Should start with 0 and be longer than 2 numbers, f.e. "frame_01.jpg"');return r}function q(e){const t=e.split(".").pop()||" ";if(!["jpg","jpeg","png","webp"].includes(t))throw new n(`Image with extension ['${t}'] is not supported.`);return`.${t}`}function z(e){return e.split("/").pop()||""}var M=class{constructor(){this.on=(e,t)=>{j.includes(e)||new O(`Event ['${e}'] is not supported.`);const r=this.observers.get(e);r?r.push(t):this.observers.set(e,[t])},this.remove=(e,t)=>{const r=this.observers.get(e);if(r){for(let i=0;i<r.length;i++)if(r[i]===t){r.splice(i,1);return}}},this.emit=(e,...t)=>{const r=this.observers.get(e);if(r)for(let i=0;i<r.length;i++)r[i](...t)},this.observers=new Map}},R=class{constructor(){if(!window)throw new n("window is not found.");if(!document)throw new n("document is not found.");this.events=new M,this.screen=this.getScreenViewport(),this.bind()}bind(){window.addEventListener("resize",l(this.handleResize.bind(this))),window.addEventListener("scroll",l(this.handleScroll.bind(this))),this.events.on(o.viewport.resize,e=>{this.screen=e})}getScreenViewport(){var e,t;return{width:window.innerWidth||((e=document.documentElement)==null?void 0:e.clientWidth),height:window.innerHeight||((t=document.documentElement)==null?void 0:t.clientHeight)}}handleResize(){this.events.emit(o.viewport.resize,this.getScreenViewport())}handleScroll(){const e=window.pageYOffset||document.documentElement.scrollTop;this.events.emit(o.viewport.scroll,e)}},H=R,W=class{constructor({framePath:e,frameCount:t}){if(!(e!=null&&e.length))throw new n("Frame path is not defined.");if(!t)throw new n("Frame count is not defined.");this.count=parseInt(t),this.path=F(e),this.image=C(e,this.count)}},k=W,D=class extends H{constructor(e){super(),this.scrollArea=0,this.inputs=e,this.identifier=e.identifier||"csc",this.frame=new k(e),e.scrollArea&&(this.scrollArea=parseInt(e.scrollArea,10))}set setScrollableArea(e){this.scrollArea||(this.scrollArea=parseInt(e))}},N=D,Y=class extends N{constructor(e,t){if(super(t),this.loading=!0,this.images=[],!e)throw new n("HTML element is not defined.");this._container=e,this._container.innerHTML="",this._container.classList.add(`${this.identifier}-container`),this._container.style.setProperty("height",`${this.scrollArea}px`),this._canvas=document.createElement("canvas"),this._canvas.classList.add(`${this.identifier}-canvas`),this._canvas.style.setProperty("display","block"),this._canvas.style.setProperty("max-height","100%"),this._canvas.style.setProperty("max-width","100%"),this._canvas.style.setProperty("object-fit","cover"),this._canvas.style.setProperty("height","100vh"),this._canvas.style.setProperty("width","100%"),this._wrapper=document.createElement("div"),this._wrapper.classList.add(this.identifier),this._wrapper.style.setProperty("position","sticky"),this._wrapper.style.setProperty("top","0"),this._wrapper.appendChild(this._canvas),this._container.appendChild(this._wrapper),this.context=this._canvas.getContext("2d"),this.viewport={width:this.screen.width,height:this.screen.height,top:0,bottom:this.screen.height,screen:this.screen},this.events.on(o.viewport.scroll,r=>{this.loading||this.drawImageByScrollFraction(m(this.viewport,r))}),this.preload()}preload(){return v(this,null,function*(){const e={total:this.frame.count,loaded:0},t=L(this.frame).map(r=>r.then(i=>(e.loaded=++e.loaded,this.events.emit(o.images.progress,e),i)));return yield Promise.all(t).then(r=>{var i,s;this.images=r,this.viewport=I(x({},this.viewport),{width:(i=this.images[0])==null?void 0:i.width,height:(s=this.images[0])==null?void 0:s.height,top:this._container.getBoundingClientRect().top+d()||0,bottom:this._container.getBoundingClientRect().bottom+d()||this.screen.height}),this._canvas.width=this.viewport.width,this._canvas.height=this.viewport.height,this.setScrollableArea=this.viewport.height*2,this._container.style.setProperty("height",`${this.scrollArea}px`),this.drawImageByScrollFraction(m(this.viewport)),this._container.classList.add(`${this.identifier}--loaded`),this.loading=!1,this.events.emit(o.images.loaded)})})}drawImage(e){e&&(this.context.clearRect(0,0,this.viewport.width,this.viewport.height),this.context.drawImage(e,0,0,this.viewport.width,this.viewport.height))}drawImageByFrameNumber(e=0){this.drawImage(this.images[e])}drawImageByScrollFraction(e){let t;t=Math.min(this.frame.count-1,Math.ceil(e*this.frame.count)),t<=0&&(t=0),this.drawImageByFrameNumber(t)}},V=Y,G=class extends V{constructor(e,t,r){super(e,t),this.callback=r||(()=>{}),this.init()}init(){this.events.on(o.images.loaded,()=>{l(this.callback())})}},J=G;console.log("running main.js");new J(document.querySelector(".scroll-video"),{framePath:"{url_of_first_frame_in_a_sequence}",frameCount:101,scrollArea:2e3});
